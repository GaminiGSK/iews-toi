# Handover Notes (Updated: Jan 2026)

## Recently Completed Work

### 1. **Real-Time "Neural Link" (Socket.io)**
- **Server**: Initialized `socket.io` in `server.js` (listening on port 5000/5001).
- **Client**: Added `SocketContext.jsx` and wrapped `App` to provide global socket access.
- **UI**: Updated `AIAssistant` to display "Online/Offline" status and listen for `agent:message`.
- **Goal**: Enables real-time updates without page refresh (e.g., when Agent finishes a task).

### 2. **Bank Statement System Stability**
- **Orphan Healing**: fix logic for transactions missing `driveId`. Created `server/scripts/heal-files.js`.
- **Exchange Rates**:
    - Fixed **Trial Balance** & **General Ledger** to fallback to `4000 KHR` if a year's exchange rate is missing (preventing invisible data).
    - Fixed issues where 2024 transactions were hidden due to Zero Rate.
- **Drive Integration**: Verified and fixed deletion/access logic.

### 3. **Document Handling Refactor**
- **Business Registration**: Refactored logic to better handle image extraction and storage (aligned with Bank Statement workflow).

---

## Immediate Next Steps

### 1. **"Living Form" Implementation** (Priority)
- **Goal**: Create a dynamic tax form interface that adapts to JSON schemas generated by the AI.
- **Action**: Build `DynamicForm.jsx` that accepts a JSON Schema (fields, types, validation) and renders inputs.
- **Binding**: Connect this form to the Socket to receive realtime schema updates from the Agent.

### 2. **Agentic Data Processing**
- **Goal**: Use the Agent to read financial data and *fill* the Living Form.
- **Action**: Implement backend logic where the Agent analyzes `Transactions` + `Tax Rules` -> Generates `Draft Return JSON` -> Pushes to Client via Socket.

### 3. **Self-Healing Logic**
- **Goal**: If the Tax Law changes (e.g., new field), the Agent should update the JSON schema automatically.
- **Action**: Store Form Schemas in MongoDB (`FormSchema` collection?) instead of hardcoding JSX.

## Technical Details
- **Socket URL**: Defaults to `localhost:5000` in Dev. Ensure `VITE_API_URL` is set for Prod.
- **Exchange Rates**: Currently hardcoded fallback (4000) exists, but User should add 2024 rates in UI.
